{% extends 'devices/base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Print Form" %} - {{ device.device_id }}{% endblock %}

{% block content %}
<div class="container">
    <div class="no-print" style="margin-bottom: 20px;">
        <button onclick="window.print()" class="btn btn-primary">{% trans "Print A4 Form" %}</button>
        <a href="{% url 'print_label' device.device_id %}" class="btn btn-secondary">{% trans "Print Label Instead" %}</a>
        <a href="{% url 'dashboard' %}" class="btn btn-secondary">{% trans "Back to Dashboard" %}</a>
    </div>

    <div class="print-formulier" style="padding: 12px; font-family: Arial, sans-serif; font-size: 10px;">
        <!-- Header with logo and barcode inline -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; border-bottom: 2px solid #000; padding-bottom: 4px;">
            <div style="flex: 0 0 auto;">
                <img src="{% static 'logo.png' %}" alt="Repair Café Logo" class="header-logo" style="height: 55px; width: auto; filter: grayscale(100%);">
            </div>
            <div style="text-align: right;">
                <div style="font-size: 14px; font-weight: bold; margin: 0;">{{ device.device_id }}</div>
                <div style="font-size: 9px;">{% trans "Intake Date" %}: {{ device.intake_datetime|date:"d-m-Y H:i" }}</div>
                <img src="{{ barcode_image }}" alt="Barcode" style="height: 28px; width: auto; margin-top: 2px;">
            </div>
        </div>

        <!-- Customer and Device Info side by side -->
        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
            <div style="flex: 1; border: 1px solid #000; padding: 6px;">
                <div style="font-weight: bold; font-size: 10px; border-bottom: 1px solid #000; margin-bottom: 4px; padding-bottom: 2px;">{% trans "Customer Information" %}</div>
                <table style="width: 100%; border-collapse: collapse; font-size: 9px;">
                    <tr>
                        <td style="padding: 2px; width: 40%; font-weight: bold;">{% trans "Customer Name" %}:</td>
                        <td style="padding: 2px;">{{ device.customer_name }}</td>
                    </tr>
                    <tr>
                        <td style="padding: 2px; font-weight: bold;">{% trans "Phone Number" %}:</td>
                        <td style="padding: 2px;">{{ device.phone_number }}</td>
                    </tr>
                    <tr>
                        <td style="padding: 2px; font-weight: bold;">{% trans "Email Address" %}:</td>
                        <td style="padding: 2px;">{{ device.email_address|default:"-" }}</td>
                    </tr>
                </table>
            </div>

            <div style="flex: 1; border: 1px solid #000; padding: 6px;">
                <div style="font-weight: bold; font-size: 10px; border-bottom: 1px solid #000; margin-bottom: 4px; padding-bottom: 2px;">{% trans "Device Information" %}</div>
                <table style="width: 100%; border-collapse: collapse; font-size: 9px;">
                    <tr>
                        <td style="padding: 2px; width: 40%; font-weight: bold;">{% trans "Device Type" %}:</td>
                        <td style="padding: 2px;">{{ device.device_type }}</td>
                    </tr>
                    <tr>
                        <td style="padding: 2px; font-weight: bold;">{% trans "Brand / Model" %}:</td>
                        <td style="padding: 2px;">{{ device.brand_model }}</td>
                    </tr>
                    <tr>
                        <td style="padding: 2px; font-weight: bold;">{% trans "Intaker" %}:</td>
                        <td style="padding: 2px;">{{ device.intaker.get_full_name|default:device.intaker.username }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Problem Description -->
        <div style="border: 1px solid #000; padding: 6px; margin-bottom: 8px;">
            <div style="font-weight: bold; font-size: 10px; margin-bottom: 4px;">{% trans "Problem Description" %}</div>
            <div style="min-height: 35px; font-size: 9px; line-height: 1.3;">{{ device.problem_description }}</div>
        </div>

        <!-- Accessories and Costs side by side -->
        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
            {% if device.accessories %}
            <div style="flex: 1; border: 2px solid #f59e0b; padding: 6px; background-color: #ffffcc;">
                <div style="font-weight: bold; font-size: 10px; color: #f59e0b; margin-bottom: 3px;">⚠️ {% trans "Accessories" %}</div>
                <div style="font-size: 9px; line-height: 1.3;">{{ device.accessories }}</div>
            </div>
            {% else %}
            <div style="flex: 1; border: 1px solid #000; padding: 6px;">
                <div style="font-weight: bold; font-size: 10px; margin-bottom: 3px;">{% trans "Accessories" %}</div>
                <div style="font-size: 9px; color: #999;">-</div>
            </div>
            {% endif %}

            <div style="flex: 1; border: 1px solid #000; padding: 6px;">
                <div style="font-weight: bold; font-size: 10px; margin-bottom: 4px;">{% trans "Investigation costs" %}</div>
                <label style="font-size: 9px; display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" {% if device.investigation_cost_paid %}checked{% endif %} disabled style="margin-right: 6px; width: 14px; height: 14px; cursor: pointer;">
                    <span>{% trans "Investigation Cost Paid" %}</span>
                </label>
            </div>
        </div>

        <!-- Work/Material Costs -->
        {% if device.work_material_costs %}
        <div style="border: 1px solid #000; padding: 6px; margin-bottom: 8px;">
            <div style="font-weight: bold; font-size: 10px; margin-bottom: 4px;">{% trans "Work / Material Costs" %}</div>
            <div style="font-size: 9px; line-height: 1.3;">{{ device.work_material_costs }}</div>
        </div>
        {% endif %}

        <!-- Repair Notes -->
        <div style="border: 1px solid #000; padding: 6px; margin-bottom: 8px;">
            <div style="font-weight: bold; font-size: 10px; margin-bottom: 4px;">{% trans "Repair Notes" %}</div>
            <div style="min-height: 50px; font-size: 9px; line-height: 1.3;">
                {% if device.repair_notes %}
                    {{ device.repair_notes }}
                {% else %}
                    <span style="color: #999;">{% trans "To be filled by repairer" %}</span>
                {% endif %}
            </div>
        </div>

        <!-- Repairer Signature -->
        <div style="border: 1px solid #000; padding: 6px;">
            <div style="font-weight: bold; font-size: 10px; margin-bottom: 3px;">{% trans "Repairer Signature:" %}</div>
            <div style="border-bottom: 1px solid #000; height: 35px;"></div>
            <div style="font-size: 9px; margin-top: 3px;">{% trans "Date:" %} _____________</div>
        </div>
    </div>
</div>

<style>
@media print {
    .no-print {
        display: none !important;
    }

    .print-formulier {
        padding: 8mm !important;
        page-break-inside: avoid;
    }

    body {
        margin: 0;
        padding: 0;
    }

    .container {
        width: 100%;
        max-width: 100%;
        padding: 0;
        margin: 0;
    }

    @page {
        size: A4 portrait;
        margin: 8mm;
    }

    /* Barcode size for print */
    img[alt="Barcode"] {
        height: 26px !important;
    }

    /* Logo size for print */
    .header-logo {
        height: 42px !important;
    }

    /* Compact spacing for print */
    .print-formulier > div {
        margin-bottom: 6px !important;
    }
}

/* Screen view */
@media screen {
    .print-formulier {
        max-width: 800px;
        margin: 0 auto;
        border: 1px solid #ddd;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        background: white;
    }
}
</style>
{% endblock %}
